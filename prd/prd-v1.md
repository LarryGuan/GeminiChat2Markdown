# Chrome 插件产品需求文档 - V1

## 1. 项目概述

本项目旨在开发一款 Chrome 浏览器插件，用于将 Gemini 分享的对话记录转换为结构化、易于阅读的 Markdown 格式，便于用户存档和查阅。

## 2. 需求背景

用户在使用 Gemini 进行对话后，希望能够方便地将对话内容导出并保存。目前 Gemini 提供的分享页面虽然可以查看对话，但其格式不便于直接存档和二次利用。因此，需要一个工具能够将这些 HTML 格式的对话内容转换为标准 Markdown 格式，并保留对话的完整性和可读性。

## 3. 功能需求

### 3.1 对话内容抓取

- 插件能够从 Gemini 分享页面（例如：`https://gemini.google.com/share/17aa16c24f42`）抓取完整的对话内容。
- 考虑到 Gemini 页面可能存在动态加载内容的情况，插件需要具备处理滚动加载、等待内容完全加载等机制，以确保抓取到所有对话。

### 3.2 HTML 到 Markdown 转换

- 插件能够识别并提取 `<user-query>` 标签内的用户发言和 `<response-container>` 标签内的 Gemini 发言。
- 转换过程中，需要将 HTML 内容智能转换为对应的 Markdown 格式，包括但不限于：
    - 标题、段落、粗体、斜体等基本文本格式。
    - 列表（有序列表、无序列表）。
    - 代码块（保留原有格式和缩进）。
    - 表格（如果存在）。
    - 链接和图片。
- 转换应尽可能保留原有格式和排版，确保良好的阅读体验。

### 3.3 对话结构化与格式化

- 区分用户和 Gemini 的发言，并在 Markdown 中明确标识。
- 过滤掉页面中的 UI 元素、广告、导航等非对话内容，只保留核心对话信息。
- 保持对话的原始顺序，确保对话流程的连贯性。
- 提取对话开始时的原始地址信息和创建时间信息，并将其保留在 Markdown 文件的摘要部分。

### 3.4 Markdown 输出格式

最终输出的 Markdown 文件应遵循以下格式：

```markdown
# 这是标题 (可根据对话内容自动生成或用户输入)

来源摘要：
- 来源网址: [Gemini 分享链接]
- 创建时间: [对话创建时间]

## Gemini (时间)
Gemini 的对话内容，已转换为 Markdown 格式，并尽可能保留原有格式和缩进。

## 用户 (时间)
用户的对话内容，已转换为 Markdown 格式，并尽可能保留原有格式和缩进。

## Gemini (时间)
Gemini 的对话内容...

## 用户 (时间)
用户的对话内容...
```

## 4. 技术考虑

- **前端技术栈**：Chrome 插件开发主要涉及 HTML, CSS, JavaScript。
- **HTML 解析**：可能需要使用 DOM 解析库（如 `DOMParser` 或第三方库）来解析 Gemini 分享页面的 HTML 结构。
- **Markdown 转换**：可能需要集成现有的 HTML-to-Markdown 转换库，并进行定制化开发以满足特定需求。
- **动态内容处理**：考虑使用 `MutationObserver` 或定时器来检测页面内容变化，确保在所有对话加载完成后再进行抓取。
- **用户界面**：插件需要一个简洁的用户界面，允许用户触发转换操作，并可能提供一些配置选项（例如，是否包含某些元数据）。

## 5. 待定事项

- 插件的具体触发方式（例如，点击浏览器图标、右键菜单）。
- 转换过程中错误处理和用户反馈机制。
- 是否支持批量转换。
- 标题的生成策略（自动生成或用户手动输入）。

## 6. 验收标准

- 插件能够成功抓取 Gemini 分享页面的所有对话内容。
- 转换后的 Markdown 文件格式正确，符合预期。
- Markdown 内容可读性高，保留了原始对话的格式和结构。
- 能够正确区分用户和 Gemini 的发言。
- 能够正确提取并显示来源网址和创建时间。
- 插件运行稳定，无明显性能问题。

---

**文档版本**：V1
**创建日期**：2024年5月15日